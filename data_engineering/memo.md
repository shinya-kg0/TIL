# データ取り込み、ストリーム処理ツール比較

| **カテゴリ** | **ツール名** | **管理元 / 主な提供形態** | **特徴・メリット** | **抑えておきたいポイント / 課題** |
| --- | --- | --- | --- | --- |
| **メッセージブローカー** (運搬・蓄積) | **Apache Kafka** | OSS / Confluent / 各クラウド | **業界標準。** 圧倒的なスループットとエコシステムの広さ。高い耐久性を持つ。 | 運用負荷（ZooKeeperや管理）が高い。スケール時のパーティション再配置が複雑。 |
|  | **Amazon Kinesis** (Data Streams) | AWS (マネージド) | **AWS特化。** 設定が簡単で、他のAWSサービス（Lambda, S3等）との親和性が極めて高い。 | シャード単位の管理が必要。AWS以外での利用は一般的ではない。 |
|  | **Google Cloud Pub/Sub** | GCP (マネージド) | **完全サーバーレス。** グローバルなスケーラビリティ。シャード管理不要で導入が最も容易。 | 順序保証の厳密な管理には設定が必要。GCP外からの利用はネットワークコストに注意。 |
|  | **Apache Pulsar** | OSS / StreamNative | **次世代型。** ストレージと計算層が分離されており、柔軟な拡張が可能。マルチテナント対応。 | Kafkaに比べると学習リソースやコミュニティがまだ成長途上。 |
| **処理エンジン** (加工・分析) | **Apache Flink** | OSS / 各クラウド | **真のリアルタイム処理。** 低遅延かつ「Exactly-once（正確に1回）」の強力な整合性保証。 | 学習曲線が急。複雑なステートフル処理に向くが、運用の難易度は高い。 |
|  | **Apache Spark** (Streaming) | OSS / Databricks | **統一エンジン。** バッチ処理と共通のコードで書ける。ML（機械学習）連携が非常に強力。 | 基本はマイクロバッチ方式（数秒単位）のため、ミリ秒単位の超低遅延には不向き。 |
|  | **Google Cloud Dataflow** | GCP (Apache Beam) | **運用の自動化。** リソースの自動スケールが優秀。バッチとストリームを同じモデルで扱える。 | Google Cloud (Apache Beam) への依存度が強くなる。デバッグがやや難しい。 |


-  イメージで理解する：アパート vs 一戸建て
    - マルチテナント（アパート）:
      - 1つの建物（システム）の中に、たくさんの部屋（テナント）があります。入り口やエレベーター、水道などのインフラは共有しますが、各部屋の鍵は別々で、プライバシーは守られています。

    - シングルテナント（一戸建て）:
      - 1つの建物（システム）を、1つの世帯（利用者）だけで独占して使います。自由度は高いですが、維持費や建設費が高くなります。

---


Apache Kafka（カフカ）を一言でいうと、  
**大量のデータを高速かつ安全にやり取りするための、超高性能なデジタル回転寿司**です。

データが流れてくるだけでなく、皿（データ）がベルトコンベアの上に一定期間残り続けるため、必要な人が好きなタイミングで取っていけるのが最大の特徴です。

---

### 1. Kafkaの登場人物（3つの役割）

Kafkaの世界は、主にこの3つの要素で動いています。

* **Producer（プロデューサー / 送り手）**
* データを生成してKafkaに投げ込む係。
* 例：スマホアプリのログ、センサーの数値、注文データなど。


* **Kafka Cluster（カフカ・クラスター / 運び手・保管庫）**
* データを受け取り、整理して保管する「回転寿司のレーン」そのもの。
* 複数のサーバー（ブローカー）で構成され、データが消えないようにコピーを作って守ります。


* **Consumer（コンシューマー / 受け取り手）**
* Kafkaからデータを取り出して処理する係。
* 例：リアルタイム分析エンジン、データベース保存用プログラムなど。



---

### 2. なぜ Kafka がこれほど使われているのか？（3つの強み）

従来の「メール」のような1対1の通信ではなく、Kafkaが選ばれるのには理由があります。

#### ① データの「一時保存」ができる（耐久性）

普通のメッセージツールは、渡したらデータが消えます。しかしKafkaは、**「過去7日間分は全部取っておく」**といった設定が可能です。

* **メリット**: もし受け取り側のシステムが故障して止まっても、復旧した後に「止まったところから再開」ができます。

#### ② 「送り手」と「受け取り手」を切り離せる（疎結合）

送り手は、受け取り側が誰か、今忙しいかどうかを気にする必要がありません。とりあえずKafkaに放り込めばOKです。

* **メリット**: システムの追加や変更がめちゃくちゃ楽になります。

#### ③ 圧倒的な「スピード」と「拡張性」

1秒間に数百万件というデータをさばけます。データ量が増えたら、サーバー（ブローカー）を横に並べて増やすだけで処理能力を上げられます。

---

### 3. Kafkaの構造：トピックとパーティション

Kafkaを理解する上で避けて通れないのが、この2つの言葉です。

* **Topic（トピック）**:
データの「カテゴリ（フォルダ）」です。「注文データ用」「アクセスログ用」のように分けます。
* **Partition（パーティション）**:
1つのトピックをさらに細分化した「レーン」です。1つのトピックを複数のレーンに分けることで、並列で処理できるようになり、爆速になります。


| **サービス** | **管理のイメージ** | **特徴** |
| --- | --- | --- |
| **自前 Kafka** | **DIY（日曜大工）** | サーバーの設置から設定まで全部自分。自由度は最高だが、壊れたら自力で直す。 |
| **Amazon MSK**
(Managed Streaming for Kafka) | **レンタカー** | Kafkaそのものを提供。メンテナンスはAWSがやるが、エンジンのサイズ（台数）は自分で選ぶ。 |
| **Amazon Kinesis** | **タクシー** | Kafkaに似た機能をAWS独自に構築。台数ではなく「シャード（車線数）」で容量を決める。 |
| **Google Cloud Pub/Sub** | **電車・バス** | **完全サーバーレス。** 容量の設定すら不要。乗った分（データ量）だけ払えば、勝手に巨大化する。 |