# 開発の流れ

1. 要件定義
2. 設計
3. 実装
4. リリース

# データベースの設計

- **何を**データとして保存するか
- **どのような**形式で保存するか

## 何をデータとして保存する？

- システムで使用するもの（商品情報など）
- ユーザーが登録するもの（氏名など）

テーブルの見出しはそのデータを抽象化したもの

例えば、、、

- 小野、内田・・・生徒の名前
- 　1. 心理学、2. 栄養学・・・科目ID、科目名
- 　1. 農学部、2. 工学部・・・学部ID、学部名

### ポイント

最初にやること

- データを抽出する
- エンティティを定義する

## どのような形式で保存するか？

- アンチパターン
  - 一意にデータが特定できない、、、
  - カンマ区切り
  - セルに複数データある
  - 科目ごとにカラムを追加→ カラムが増えるたびにカラムが増える、、、柔軟性×


### ポイント

- 主キーが必要！
  - 値を指定すれば、1行のレコードを特定できる
  - テーブル内に必ず一つだけ存在
  - テーブルは重複データを持てない

- 生徒と科目の組み合わせごとに行を追加
  - 主キーを生徒IDと科目IDの組み合わせと見れば、主キーが各列の値を一意に特定できる
  - 例えば、小野、農学部、心理学で1レコード、小野、農学部、心理学で1レコード

- 第一正規形
  - 一つのセルの中には一つの値しか含まない。効率よく検索できる
  - 正規形・・・一貫性と効率性を持った形でデータを保持するためのデータ形式
  - 正規化・・・一貫性と効率性を持つようにデータベースを設計する

- 関数従属性
  - y=f(x): 入力xに対して出力yが決まる
  - yはxに従属する: {x} -> {y}
  - 一つのセルに一つの値の方針も関数従属性
  - テーブル設計では全ての列が関数従属性を満たすように整理していく


- 第二正規形
  - 第一正規形から部分関数従属を排除
  - 部分関数従属・・・主キーの一部に対して従属する列がある
  - **テーブル分割**でデータに矛盾がなくなる

- 第三正規形
  - 第二正規形から推移的関数従属を排除
  - 推移的関数従属・・・テーブル内に段階的な関数従属関係がある
  - テーブルを分割すると、他のデータと紐づかないデータも登録できる


- 第三正規形まで正規化すれば基本OK！
- 第六まであるが、第三までで十分なケースが多い
- データに矛盾が生じないことが何より重要

# ER図

## 1対多

- 正規化によって生まれる関連

## 多対多

- テーブル設計上NG
- 両方を紐づけることができない
- 無理やり紐づけると正規化ができてない状態に、、、
- 解決するには、、、
  - **中間テーブル**を作る！
  - 正規化していけば、自然とこと形になる

## ポイント

- テーブル同士を線で繋ぎ、中身の種類や関係性をみやすくしたもの
- テーブル間における関係として1対1、1対多、多対多がある

# テーブルの定義

- どうやって定義する？
- データ型とか主キーの設定などの設定は？？

## テーブル定義時に考えること

基本的はNULLは避けたい（NOT NULL制約はつけた方が無難）

- テーブル名
- **カラム名、データ型、PK、NOT NULL、デフォルト**

- データ型
  - INT：整数
  - VARCHAR：文字列
  - DATE：日付


## ポイント

- 上記に加え、外部キー制約、ユニーク制約、チェック制約、オートインクリメントなども考慮すれば完璧


## テーブル定義後にやること

- **インデックスの設定**
- パフォーマンス向上が目的

実務上で重要、、、

データベースのパフォーマンスがネックになりがち、、、

# まとめ

## 手順編

- データの抽出
- エンティティの定義
- 正規化
- ER図
- テーブル定義
- インデックス設計

〜ER図までは論理設計、後ろは物理設計


## 設計編

- 要件を満たすテーブルやカラムを作成する
- 必要データはアプリが決める
- 要件定義をしっかり行う、理解する
- データに矛盾が生じないように正規化する

## 正規化編

- 第一：一つのセルに値が一つ
- 第二：主キーの一部だけしか利用してないのに一意に定まる列が存在していないか
- 第三：主キー以外の列同士（多段階）で従属する列は存在していないか

