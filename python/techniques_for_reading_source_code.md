# ソースコードを読むための技術

[このページ](https://i.loveruby.net/ja/misc/readingcode.html)を参考にした。

## 方針を決める
読むプログラムは決まっているとして、方針もなく前から読んでいくのはあまりよくない。

まず**コードを読む目的を明確に決め、それだけに集中**するようにする。  
全てを読む必要があるときも、パートを分けて読んでいくことを意識する。

コードを読む目的とは？？  
→ おそらくコードを読むことになるのは機能追加や、修正、調査などが主になるはず  
　**自分が何を知りたいのか**（例えば似たような処理を使っていないか、おおまかに真似できないかなど）を明確にすることが大事  
　調査については別でまとめる標準調査プロセスが有効になる

## 解析の手法
おおまかに静的な手法と動的な手法がある。

静的な手法・・・ソースコードそれ自体を読むこと  
動的な手法・・・デバッガーを使って実行時の動きを追うこと

**基本的には動的解析から始める**のが良い。静的解析だと、プログラムの動作を予測することになる。動的解析だと事実を追うことになる。まず事実を見ておいた方が方向付けしやすい。

個人的には、そもそもコードを見る前に**このプログラムは何をすることが目的なのか**というかなり抽象的なところから理解しておかないと、デバッガで動かしたところを見てもあまり理解できない気がする。（体験談）

抽象的なところ（例えば、このプログラムはAからBに変換するもの）を理解できていれば、どこかにAの要素を取ってくる関数や、Bを作成する関数があるだろうという予測のもと動的解析を行うことができる。

抽象的な部分を理解するには、そのプログラムに詳しい人に聞くか、ドキュメントを探すのが手っ取り早いと思う。

## 静的な解析手法
- 対象プログラムを使う
  - このプログラムがどういうものなのか、どういう動作をするのかをチェック

- ドキュメントを読む
  - まずは仕様を理解すること。内部構造を解説したドキュメントがあれば見ておきたい<br>「HACKING」「TOUR」などという名前のファイルがあったら要チェック。（C言語の場合）

- ディレクトリ構成を読む
  - どういう方針でディレクトリが分割されているのか見る。そのプログラムがどういう作りになっているのか、どういうパートがあるのかなど概要を理解する。それぞれのモジュールがどういう関係にあるのか確かめる。

- ファイル構成を見る
  - ファイルの中に入っている関数を合わせて見ながら、どういう方針でファイルが分割されているのかを見る。**ファイルは衰えないコメント**のようなものであり、注目すべき。
  - 関数名の名前付けルールについてもあたりをつけておくと便利（プレフィックスなど）

- 略語の調査
  - わかりにくい略語があればリストアップして早めに調べる。意味をまちがって理解していると前提が変わってくる。<br>例）`blt` → built-in-function

- データ構造を知る
  - プログラムなんて、データ構造がどうなっているのか分かれば もう半分勝ったようなものだ。コードを書くときも、 コードに逐一コメントを付けるよりデータ構造 (だけ) を 解説するほうがはるかに役に立つ。（引用：『プログラム書法』）
  - 例えば、Pythonだと型ヒントをつけておくとだいぶ読みやすいと感じた。<br>そのオブジェクトが何の情報を持てるのか、この情報を持っているとしたらこの関数はどういう処理をする可能性が高いなどあたりがつけやすくなる。
  - **データ構造を意識**するとプログラムが読みやすくなると感じた。（読めるとは言っていない、、、）

- 関数の呼び出し関係を把握する
  - 関数名の次に重要な情報。特に関数の数が多い場合。さっとでいいので図を書いてみるとわかりやすい。

- 関数を読む
  - プログラムの構造によるが、パートごとに読んでいく。（初めから or メインループ）
  - まず**何を読まないか**を考えた方がいい。エラー処理や不要な分岐、あまり使われていない場合わけなどは全部飛ばす。
  - ガード分がうまく使われているとこのステップが楽になる。逆にこういうところを楽にするために例外やガード文を使っていく。

## 名前の大切さ
ソースコードの読解とは**名前の調査**であるようだ。ファイル名、関数名、変数名などブログラムは名前の塊である。  
名前はプログラムを抽象化する最大の武器なので、この点を意識するとかなり効率が上がるのではないか。


## 歴史を読む

プログラムには大抵変更箇所をの履歴があるはずで、**プログラムがそうなっている理由**を知るのに役立つ。（例えばコミット履歴など）

## 解析ツール
以下、略